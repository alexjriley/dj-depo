{% extends 'base.html' %}
{% load static %}

{% block hero %}
  <!-- Full width hero carousel -->
  <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="{% static 'images/pexels-gigxels-7709006.jpg' %}" class="d-block w-100 hero-img" alt="hero-1">
      </div>
      <div class="carousel-item">
        <img src="{% static 'images/pexels-wendelinjacober-1447957.jpg' %}" class="d-block w-100 hero-img" alt="hero-2">
      </div>
      <div class="carousel-item">
        <img src="{% static 'images/pexels-inga-sv-3550240.jpg' %}" class="d-block w-100 hero-img" alt="hero-3">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

  <!-- Intro container under the hero -->
  <div class="container py-5">
    <div class="row align-items-center">
      <div class="col-md-8 col-lg-8">
        <h1 class="display-4">Find your next favorite mix</h1>
        <p>Browse, listen, and share DJ mixes from across the community.</p>
      </div>
      <div class="col-md-4 text-md-end">
        <a href="{% url 'upload_audio' %}" class="btn btn-lg btn-dark">Upload a mix</a>
      </div>
    </div>
  </div>
{% endblock %}

{% block content %}
<section id="discover" class="container mt-4">
  <h2 class="mb-4 text-center">Discover</h2>

  {% if posts %}
  <div class="row g-4">
    {% for post in posts %}
    <div class="col-12 mix-col">
      <div class="card h-100">
        {% if post.audio_file.url %}
        <div class="ratio ratio-16x9 p-3">
          <!-- Unique container with data attributes -->
          <div id="waveform-{{ post.id }}"
               class="waveform"
               data-post-id="{{ post.id }}"
               data-audio-url="{{ post.audio_file.url }}"></div>

          <button class="btn btn-success btn-sm mt-2 playPause" data-post-id="{{ post.id }}">
            â–¶ Play / Pause
          </button>
        </div>
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <p class="card-text text-muted">by {{ post.user.username }}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if user.is_authenticated %}
  <div class="row mt-3">
    <div class="col-12 col-lg-auto">
      <a class="btn btn-dark w-100 w-lg-auto" href="{% url 'upload_audio' %}">
        <span class="d-none d-lg-inline">Upload&nbsp;new&nbsp;audio</span>
        <span class="d-inline d-lg-none">Upload new audio</span>
      </a>
    </div>
  </div>
  {% else %}
  <p class="mt-3">
    <a class="btn btn-outline-primary" href="{% url 'login' %}">Login</a> to upload audio.
  </p>
  {% endif %}
  {% else %}
  <p>No mixes uploaded yet.</p>
  {% endif %}
</section>

{% endblock %}
{% block extra_scripts %}
<!-- Page-specific JS (after Wavesurfer is loaded in base.html) -->
<script src="{% static 'mixes/js/wavesurfer-init.js' %}"></script>
{% endblock %}